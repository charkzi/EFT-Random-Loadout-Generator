<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>EFT Random Loadout Generator â€“ Mit Attachments</title>
<style>
:root { --bg:#0b0b0b; --card:#161616; --text:#eaeaea; --button:#2a2a2a; }
body.light { --bg:#f4f4f4; --card:#ffffff; --text:#111; --button:#ddd; }
body { background:var(--bg); color:var(--text); font-family:Arial,sans-serif; text-align:center; margin:0; padding:0 10px 40px; transition:.3s; }
button { padding:12px 18px; font-size:16px; margin:8px; cursor:pointer; background:var(--button); color:var(--text); border:none; border-radius:6px; }
input { width:90%; padding:10px; margin-top:10px; background:var(--card); color:var(--text); border:1px solid #555; border-radius:6px;}
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:14px; max-width:1000px; margin:20px auto; }
.item { background:var(--card); padding:10px; border-radius:8px; }
.item img { width:100%; max-height:160px; object-fit:contain; }
</style>
</head>
<body>

<h1>ğŸ¯ EFT Random Loadout</h1>

<button onclick="generateLoadout()">ğŸ”„ Neues Loadout</button>
<button onclick="generateShareLink()">ğŸ”— Share-Link</button>
<button onclick="toggleTheme()">ğŸŒ— Dark/Light</button>
<br>
<input id="shareLink" readonly placeholder="Share-Link">

<div class="grid" id="loadout"></div>

<script>
// Theme Toggle
const savedTheme = localStorage.getItem("theme");
if (savedTheme === "light") document.body.classList.add("light");
function toggleTheme() {
  document.body.classList.toggle("light");
  localStorage.setItem("theme",
    document.body.classList.contains("light") ? "light" : "dark");
}

// ZufÃ¤llige Map
const maps = ["Customs","Woods","Shoreline","Interchange","The Lab","Reserve","Lighthouse"];
function pick(arr) { return arr && arr.length ? arr[Math.floor(Math.random()*arr.length)] : null; }

// Card HTML
function card(title, item) {
  if (!item) return `<div class="item"><h3>${title}</h3><div>Keine Daten</div></div>`;
  return `<div class="item"><h3>${title}</h3>${item.iconLink?`<img src="${item.iconLink}">`:''}<div>${item.shortName||item.name||''}</div></div>`;
}

// Random Attachments 0-10
function getRandomAttachments() { return Math.floor(Math.random()*11); }

// Fallback-Daten (offline nutzbar, falls API ausfÃ¤llt)
const fallbackItems = {
  weapons: [
    {id:"ak74m", name:"AKâ€‘74M", caliber:"5.45x39mm"},
    {id:"m4a1", name:"M4A1", caliber:"5.56x45mm"},
    {id:"mp5", name:"HK MP5", caliber:"9x19mm"}
  ],
  helmets: [
    {id:"kiver", name:"Kiver Helmet"},
    {id:"psh97", name:"PShâ€‘97 Helmet"}
  ],
  armors: [
    {id:"paca_soft", name:"PACA Soft Armor"},
    {id:"6b23", name:"6B23 Armor"}
  ],
  rigs: [
    {id:"avs", name:"Crye AVS"},
    {id:"blackrock", name:"BlackRock Chest Rig"}
  ],
  backpacks: [
    {id:"6sh118", name:"6Sh118 Backpack"},
    {id:"pilgrim", name:"Pilgrim Backpack"}
  ],
  ammo: [
    {id:"545bp", name:"5.45Ã—39mm BP", caliber:"5.45x39mm"},
    {id:"556m855", name:"5.56Ã—45mm M855", caliber:"5.56x45mm"},
    {id:"9x19fmj", name:"9x19mm FMJ", caliber:"9x19mm"}
  ]
};

let currentLoadout = null;

async function generateLoadout(forced=null){
  const container = document.getElementById("loadout");
  container.innerHTML = "â³ Lade Loadoutâ€¦";

  try{
    // --- Offline Fallback
    const weapons = fallbackItems.weapons;
    const helmets = fallbackItems.helmets;
    const armors = fallbackItems.armors;
    const rigs = fallbackItems.rigs;
    const backpacks = fallbackItems.backpacks;
    const ammo = fallbackItems.ammo;

    // Waffe & passende Munition
    const weapon = forced?.weapon ? weapons.find(w=>w.id===forced.weapon) : pick(weapons);
    const compatibleAmmo = ammo.filter(a=>a.caliber===weapon.caliber);
    const selectedAmmo = pick(compatibleAmmo);

    // Rig & Armor Logik
    const armoredRigs = rigs.filter(r=>r.name.toLowerCase().includes("armored"));
    const normalRigs = rigs.filter(r=>!r.name.toLowerCase().includes("armored"));
    const heavyArmor = armors.filter(a=>a.name.toLowerCase().includes("armor"));
    const lightArmor = armors.filter(a=>!a.name.toLowerCase().includes("armor"));

    let rig = null;
    let armor = null;

    if(Math.random()<0.5){
      rig = pick(armoredRigs.concat(normalRigs));
      armor = rig.name.toLowerCase().includes("armored") ? null : pick(heavyArmor.concat(lightArmor));
    }else{
      armor = pick(heavyArmor.concat(lightArmor));
      rig = armor?.name.toLowerCase().includes("armor") ? pick(normalRigs) : pick(armoredRigs.concat(normalRigs));
    }

    // Map & Attachments
    const map = pick(maps);
    const attachmentValue = getRandomAttachments();

    currentLoadout = {
      weapon: weapon?.id||'',
      helmet: helmet?.id||'',
      armor: armor?.id||'',
      rig: rig?.id||'',
      backpack: backpack?.id||'',
      map: map,
      attachments: attachmentValue
    };

    // Anzeige
    container.innerHTML =
      card("ğŸ”« Waffe", weapon) +
      card("ğŸ¥½ Helm", helmet) +
      card("ğŸ›¡ï¸ RÃ¼stung", armor) +
      card("ğŸ’ Rig", rig) +
      card("ğŸ’ Rucksack", backpack) +
      `<div class="item"><h3>ğŸ—º Map</h3><div>${map}</div></div>` +
      `<div class="item"><h3>ğŸ² Attachments</h3><div>${attachmentValue}</div></div>`;

  }catch(e){
    container.innerHTML = "âŒ Fehler beim Laden der Daten.";
    console.error(e);
  }
}

// Share-Link
function generateShareLink(){
  if(!currentLoadout) return;
  const encoded = btoa(JSON.stringify(currentLoadout));
  const url = `${location.origin}${location.pathname}?loadout=${encoded}`;
  document.getElementById("shareLink").value = url;
}

// Load shared loadout
const params = new URLSearchParams(window.location.search);
if(params.has("loadout")){
  try{ const decoded = JSON.parse(atob(params.get("loadout"))); generateLoadout(decoded); }
  catch{ generateLoadout(); }
}else{
  generateLoadout();
}
</script>

</body>
</html>
