<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>EFT Random Loadout Generator ohne Fallback</title>
<style>
  body { background: #0b0b0b; color: #eaeaea; font-family: Arial, sans-serif; text-align: center; transition: all 0.3s; }
  button { padding: 14px 28px; font-size: 18px; cursor: pointer; margin: 20px; }
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; max-width: 1200px; margin: auto; }
  .item { background: #161616; padding: 12px; border-radius: 10px; transition: all 0.3s; }
  .item img { width: 100%; max-height: 180px; object-fit: contain; }
  h3 { margin: 8px 0 4px; }
  .toggle { position: fixed; top: 10px; right: 10px; padding: 10px; cursor: pointer; background: #333; border-radius: 8px; }
  .light { background: #eaeaea; color: #0b0b0b; }
  .light .item { background: #ddd; color: #0b0b0b; }
</style>
</head>
<body>

<h1>ğŸ¯ Escape from Tarkov â€“ Random Loadout</h1>
<button onclick="generateLoadout()">ğŸ”„ Neues Loadout</button>
<div class="toggle" onclick="toggleTheme()">ğŸŒ“ Dark/Light</div>

<div class="grid" id="loadout"></div>

<script>
function pick(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
function card(title, item) { return `<div class="item"><h3>${title}</h3>${item.name}</div>`; }
function toggleTheme() { document.body.classList.toggle("light"); }

async function generateLoadout() {
  const API = "https://api.tarkov.dev/graphql";

  try {
    const query = `
    {
      weapons: items(types: [gun]) { name caliber }
      helmets: items(types: [headwear]) { name }
      armors: items(types: [armor]) { name }
      rigs: items(types: [rig]) { name }
      backpacks: items(types: [backpack]) { name }
      ammo: items(types: [ammo]) { name caliber }
      maps: items(types: [map]) { name }
    }`;
    
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query })
    });
    const data = (await res.json()).data;

    // Waffe & passende Munition
    let weapon = pick(data.weapons);
    let compatibleAmmo = data.ammo.filter(a => a.caliber === weapon.caliber);
    let selectedAmmo = pick(compatibleAmmo);

    // Rig & Armor Logik
    let rig = pick(data.rigs);
    let armorChoice = rig.name.toLowerCase().includes("plate") || rig.name.toLowerCase().includes("armored")
                      ? null
                      : pick(data.armors);

    let helmet = pick(data.helmets);
    let backpack = pick(data.backpacks);
    let map = pick(data.maps);

    // Random Zahl 0-10 als Attachment
    let randomAttachments = Math.floor(Math.random() * 11);

    document.getElementById("loadout").innerHTML = `
      ${card("ğŸ”« Waffe", weapon)}
      ${card("ğŸ² Attachment-Wert (0-10)", {name: randomAttachments})}
      ${selectedAmmo ? card("ğŸ’¥ Munition", selectedAmmo) : ""}
      ${card("ğŸ›¡ï¸ Armor", armorChoice || {name:"Keine zusÃ¤tzliche Armor"})}
      ${card("ğŸ’ Rig", rig)}
      ${card("ğŸ¥½ Helm", helmet)}
      ${card("ğŸ’ Rucksack", backpack)}
      ${card("ğŸ—ºï¸ Map", map)}
    `;
  } catch (e) {
    document.getElementById("loadout").innerHTML = "Fehler beim Laden der Daten â€” API ist momentan nicht erreichbar oder antwortet falsch.";
    console.error(e);
  }
}

// Initiales Loadout
generateLoadout();
</script>

</body>
</html>

